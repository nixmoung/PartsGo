<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>검색 결과 - PartsGo</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .sort-controls {
            margin-bottom: 20px;
            text-align: right;
        }
        .sort-controls label {
            margin-right: 10px;
        }
        .sort-controls select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #333;
            color: #e0e0e0;
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">PartsGo</a>
            <nav class="main-nav">
                <a href="#">로그인</a>
                <a href="#">회원가입</a>
                <a href="#">고객센터</a>
            </nav>
        </div>
    </header>

    <section class="search-section">
        <form action="search.html" method="get" style="display: flex; justify-content: center;">
            <input type="text" name="query" class="search-bar" placeholder="찾고 계신 부품을 검색해보세요.">
            <button type="submit" class="search-button">검색</button>
        </form>
    </section>

    <div class="container main-content">
        <main class="product-grid">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 id="search-result-title"></h2>
                <div class="sort-controls" id="sort-controls-container" style="display: none;">
                    <label for="sort-select">정렬:</label>
                    <select id="sort-select">
                        <option value="default">기본</option>
                        <option value="date-desc">최신순</option>
                        <option value="price-asc">가격 낮은순</option>
                        <option value="price-desc">가격 높은순</option>
                    </select>
                </div>
            </div>
            <div id="product-list-container" class="product-grid-container">
                <!-- 검색 결과가 여기에 동적으로 생성됩니다. -->
            </div>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 PartsGo. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="js/data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const query = params.get('query');
            
            const titleElement = document.getElementById('search-result-title');
            const listContainer = document.getElementById('product-list-container');
            const searchInput = document.querySelector('input[name="query"]');
            const sortSelect = document.getElementById('sort-select');
            const sortControlsContainer = document.getElementById('sort-controls-container');

            let currentProducts = [];

            const renderProducts = (products) => {
                listContainer.innerHTML = '';
                let productsHTML = '';
                products.forEach(item => {
                    productsHTML += `
                        <a href="detail.html?id=${item.id}" class="product-item-link">
                            <div class="product-item">
                                <img src="${item.img}" alt="${item.name}">
                                <h4>${item.name}</h4>
                                <p class="price">${item.price.toLocaleString()}원</p>
                            </div>
                        </a>
                    `;
                });
                listContainer.innerHTML = productsHTML;
            };

            const sortProducts = () => {
                const sortBy = sortSelect.value;
                let sortedProducts = [...currentProducts];

                if (sortBy === 'price-asc') {
                    sortedProducts.sort((a, b) => a.price - b.price);
                } else if (sortBy === 'price-desc') {
                    sortedProducts.sort((a, b) => b.price - a.price);
                } else if (sortBy === 'date-desc') {
                    sortedProducts.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
                }

                renderProducts(sortedProducts);
            };

            if (query) {
                const decodedQuery = decodeURIComponent(query).toLowerCase();
                searchInput.value = decodeURIComponent(query);
                document.title = `"${decodeURIComponent(query)}" 검색 결과 - PartsGo`;
                
                for (const category in partsData) {
                    partsData[category].items.forEach(item => {
                        if (item.name.toLowerCase().includes(decodedQuery)) {
                            currentProducts.push(item);
                        }
                    });
                }

                if (currentProducts.length > 0) {
                    titleElement.textContent = `"${decodeURIComponent(query)}"에 대한 검색 결과`;
                    sortControlsContainer.style.display = 'block'; // 검색 결과 있을 때만 정렬 보이기
                    renderProducts(currentProducts);
                    sortSelect.addEventListener('change', sortProducts);
                } else {
                    titleElement.textContent = `"${decodeURIComponent(query)}"에 대한 검색 결과가 없습니다.`;
                }

            } else {
                titleElement.textContent = '검색어를 입력해주세요.';
            }
        });
    </script>

</body>
</html>